process {
    shell = ['/bin/bash', '-euo', 'pipefail']
    container = 'stuartlee/nf-str:latest'
    eh_catalog = "${projectDir}/catalogues/ExpansionHunter_hg38.json"
    scattr_catalog = "${projectDir}/catalogues/scattr_hg38.tsv"
    atarva_bed = "${projectDir}/catalogues/STRchive-disease-loci.hg38.atarva.bed.gz"
    straglr_bed = "${projectDir}/catalogues/STRchive-disease-loci.hg38.straglr.bed"
    longtr_bed = "${projectDir}/catalogues/STRchive-disease-loci.hg38.longTR.bed"
    trgt_bed = "${projectDir}/catalogues/STRchive-disease-loci.hg38.TRGT.bed"
    strkit_catalog="${projectDir}/catalogues/STRkit_pathogenic_assoc.hg38.tsv"
}


process {
    withName: 'download_s3_files' {
        container = null
    }
}

// downloading from public s3 buckets without credentials
aws {
    client {
        anonymous = true 
    }
}

profiles {
    
    // miltion hpc cluster with apptainer
    // this is also the target profile for GEL as 
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        process.container = 'stuartlee/nf-str:latest'
        errorStrategy { 'ignore' }
    }
    
    // biobank clouds (AoU = google cloud)
    cloud {
        docker.enabled = true
        process.container = 'stuartlee/nf-str:latest'
        process.executor = 'google-batch' 
    }
}

'''
plugins {
    id 'nf-boost@0.3.1'
    //confirmed working with Nextflow v24.10.5
}

// Enable nf-boost cleanup
boost {
    cleanup = true
    cleanupInterval = 60
}
'''